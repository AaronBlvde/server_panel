{% extends "layout.html" %}

{% block title %}Логи контейнера{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="row justify-content-center">
    <div class="col-lg-10">
      <div class="card shadow-sm">
        <div class="card-header bg-dark text-white">
          <h4 class="mb-0">Логи контейнера: {{ container.name }}</h4>
        </div>
        <div class="card-body p-0">
          <div id="log-container" class="p-3"
               style="height: 400px; overflow-y: auto; background-color:#1e1e1e; color:#e0e0e0; font-family: monospace; white-space: pre-wrap;">
            <!-- Логи будут загружены сюда -->
          </div>
        </div>
        <div class="card-footer text-end">
          <a href="{{ url_for('main.containers') }}" class="btn btn-secondary">Назад</a>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
const logContainer = document.getElementById("log-container");
const containerId = "{{ container.id }}";

function highlightLine(line) {
    if (/ERROR/.test(line)) {
        return `<span style="color:#ff4c4c;">${line}</span>`;
    } else if (/WARN|WARNING/.test(line)) {
        return `<span style="color:#ffa500;">${line}</span>`;
    } else {
        return line;
    }
}

async function fetchLogs() {
    try {
        const response = await fetch(`/containers/${containerId}/logs_json`);
        const data = await response.json();
        if (!data.error) {
            const lines = data.logs.split('\n');
            logContainer.innerHTML = lines.map(highlightLine).join('<br>');
            logContainer.scrollTop = logContainer.scrollHeight; // автоскролл вниз
        } else {
            logContainer.textContent = data.error;
        }
    } catch (err) {
        console.error("Ошибка при получении логов:", err);
        logContainer.textContent = "Ошибка при получении логов";
    }
}

// обновляем каждые 3 секунды
setInterval(fetchLogs, 3000);
fetchLogs();
</script>
{% endblock %}
